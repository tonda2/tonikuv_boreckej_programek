<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Moje single page application</title>
    <script>
        function nactisvatky (){
            setInterval(seznamzprav, 1000);
            document.getElementById("kalendar").valueAsDate = new Date();
            svatekdledata();
            fetch("http://localhost:150/svatky").then(function(response) {
                response.text().then(function(text) {
                    let obj = JSON.parse(text);
                    document.getElementById("datum").innerHTML = obj.datumCesky;
                    document.getElementById("svatek").innerHTML = obj.svatek;
                    document.getElementById("svatekZitra").innerHTML = obj.svatekZitra;
                });
            });
        }
        function svatekdledata (){
            let d = document.getElementById("kalendar").valueAsDate;
            fetch("http://localhost:150/svatky?d="+d.getDate()+"&m="+(d.getMonth()+1)).then(function(response) {
                response.text().then(function(text) {
                    let obj = JSON.parse(text);
                    document.getElementById("svatek3").innerHTML = obj.svatek;
                });
            });
        }
        function poslizpravu(){
                let chatmsg = document.getElementById("chatmsg").value;
                let prezdivka = document.getElementById("prezdivka").value;
                fetch("http://localhost:150/chat/addmsg?msg="+prezdivka+": "+chatmsg).then(function(response) {
                    response.text().then(function(text) {
                        let obj = JSON.parse(text);
                    });
                    document.getElementById("chatmsg").value = "";
                    document.getElementById("prezdivka").value = "";
                });
        }
        function seznamzprav() {
            let chatmsg = document.getElementById("chatmsg").value;
            fetch("http://localhost:150/chat/listmsgs").then(function (response) {
                response.text().then(function (text) {
                    let obj = JSON.parse(text);
                    let s = "";
                    for (let o of obj.messages) {
                        s = s + o.time + "<br>" + o.text + "<br>";
                    }
                    document.getElementById("chatmsgs").innerHTML = s;
                });
            });
        }
        function enter(){
            if (event.keyCode === 13) {
                poslizpravu();
            }
        }
    </script>
</head>
<body onload = nactisvatky() style="background-color: aqua">

<h1 style = "color: red; font-size:50px">Supr appka na svátky</h1>
<span style="font-size: 20px"> Dnes je <span id = "datum">...</span>, svátek má <span id="svatek">...</span>.
    <br>Zítra má svátek <span id = "svatekZitra"></span>. Toník má svátek 13. června.</br></span>
<br>
<h1>Chat</h1>
<div id = "chatmsgs"></div>
<input type="text"  id="prezdivka" placeholder="Přezdívka">
<br>
<input type="text"  id="chatmsg" onkeydown="enter()" placeholder="Zpráva"><input type="button" value = "Odešli" onclick = "poslizpravu()">
<br><br>
<input type="date" id ="kalendar" onchange = "svatekdledata()"> má svátek <span id="svatek3">...</span>.
<br><br>
<img src= "borci.jpg" width="500">
<br>
<b>Tohle jsou mega borci</b>

</body>
</html>